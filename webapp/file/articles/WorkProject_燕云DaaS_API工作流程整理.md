---
title: WorkProject_燕云DaaS_API工作流程整理
date: 2016-8-13 11:39:43
tags: WorkProject
categories: WorkProject
---


一.准备
======================

1.项目需求；
------------------------
　从各地不同网站，爬取数据


---
<br><br>



2.任务目标：
---------------------
　　使用Java,编写API接口,以及编写入库脚本

---
<br><br>


---
<br><br><br>


四.工作流程
================================



1.使用虚拟桌面
----------------------
```
<1>登录虚拟桌面
　　a.安装谷歌浏览器，打开并在地址栏输入
　　　　`192.168.71.184/Citrix/yanphone-storeWeb/`
　　b.点击下载插件，下载完成后,安装插件
　　c.使用用户名和密码登录，登录成功后，点击左下角插件
　　启动PC桌面版的
　　　　(Citrix Connection Manager),连接服务器，进行虚拟桌面的操作


**************************************************

<2>打开Ecplise，创建燕云Dass工程
+ 命名：bnuser_机号
+ 新建API仓库
　　a.项目名称: bnuser_机号

　　b.URL: https://yanphonepc10.vdi.bona.com/svn/pro/
　　b-2.用户名： 用户名
　　b-3.密码: 密码


**************************************************

<3>分析任务目标网页(例：招标公告)的源码以及请求
　　打开谷歌浏览器  F12
　　　　测试跳页，查看是否有动态请求(表名是否需要做Combine和Params)
			F12	
				Network	->	第一个 -> Headers	->	From Date(其他浏览器也可以，例如火狐)


**************************************************

<4>使用Plant工具，抓取数据(Detail可能有附件，可能没附件)
　　a.选中工程项目，点击Plant，弹出一个窗口，然后在里面地址栏
输入要抓取页面的URL，然后开始浏览，第1页(抓取Params)，第2页(抓取List)
然后再第2页里，选中一个招标公告，点击进去浏览(抓取Detail)
　　b.返回Ecplise，选中工程项目，选择"停止Plant"，等待控制台红灯结束，并且生成了internetware目录，抓取完毕。


**************************************************

<5>搜索api(记得先分析页面是否需要做Combine的)
　　a.用虚拟桌面的谷歌浏览器，打开招标网页，复制招标公告
　　b-1.搜索api----->     (第一页)
　　　　　　　　格式：编号-文件名-省份首字母大写+Params
　　b-2.搜索api----->      (第二页)
　　　　　　　　格式：编号-文件名-省份首字母大写+List
　　b-3.搜索api----->查找Detail  (随便一页，有附件优先)
　　　　　　　　格式：编号-文件名-省份首字母大写+Detail
　　b-4.复制list        (也是第二页)
　　            格式：编号-文件名-省份首字母大写+Combine
　　c.删除其他目录


**************************************************

<6>改名
　　a.把上面List文件夹的api.xml文档，顶部id>和alias-name>标签改名
　　　　id的改为与List目录相同
　　　　alias-name改为 编号+省份首字母大写+List
　　b.其他相同



**************************************************

<7>导入工具类，创建相应包，类
　　a.工程项目下
　　　　--->导入jar包(lib目录里面)
　　　　--->Build Path---->导入jar包
　　b.src目录下-->导入工具包cn.internetware.utils
　　     --->创建包，命名:省份首字母大写+编号　　
　　　　 --->创建类：1. ZBlist;  2.ZBDetail; 3.ZBParams 4.ZBCombain



**************************************************


<8>编写API
　　a.根据初始模版，编写解析html页面的代码，抓取数据
　　b.测试：在控制台上打印输出需要的值
　　　　ZBlist 记得关键属性，title  id  date  pageCount
　　　　ZBDetail  主体内容[and 附件的链接]---包过html标签，输出内容，
　　　　　　可以用html格式在浏览器中显示
　　　　ZBParams 
　　　　ZBCombine



**************************************************


<9>项目运行文件（相当于配置peoject.xml）
　　a.选中工程项目，右键---->燕云Dass----->配置运行文件
　  b.点击ordered-apis----->新建两个api
　　API:选择抓取的api目录（List的）      包名.类名
　　 API:选择抓取的api目录（Detail的）    包名.类名
　　c.保存
　　 d.查看工程项目的project.xml，是否有自动生成


**************************************************


<10>项目文件配置
　　a.选中工程项目，右键---->燕云Dass---->项目文件配置
　　b.点击apis，右键，添加api------>点击选择
　　　　　　　　　　　　--->重点是配置testUrl

如果很多包，只配置一个就行了，只是为了点击reactor，弹窗有个默认页


**************************************************


<11>在谷歌浏览器中，显示抓取的数据
　　a.选中项目，点击"启动reactor"【启动代理】
　　b.在虚拟桌面打开谷歌浏览器
　　　　　　---->地址栏中粘贴URL(上面配置的testUrl)--->Enter测试
　　c.地址栏右边图标点击----》设置-------》扩展程序-------》
　　  将插件直接啦进来
　　　　`jsonview-chromein.com_ext_11247.crx`  
　　d.重新刷新页面，查看爬取的网站数据是否以规定格式显示
　　e.判断List是否有按照要求显示title,id,date,pageCount
　　e-2:观察list目录的api.xml中，有没有跳页参数，有的话测试能否跳页
　　　　没有就在
　　　　　　　request-path>和/request-path>   ---配置网址
　　　　　　　request-uri-replacement-pattern>和    ---配置正则表达式
　　　　　　　/request-uri-replacement-pattern>
　　f.Detail同上，看能否根据获取的id跳页
　　g.测试List和Detail能否进行跳页


```

---
<br><br>


2.本地使用eclipse(燕云dds工具)
--------------------------
```
<1>先根excel表格编写文档

<2>根据文档浏览网站，分析结构
　　。浏览同种类型第1页，第2页，观察URL变化
　　。浏览不同类型(招标，中标)的URL变化
　　。分析跳入Detail的id变化

<3>使用eclipse的抓包工具(plant)进行抓包，并搜索出对应的List，Detail(可能需要Params，Combine)，将其放到相应的文件夹

<4>修改各个api目录的api.xml的映射名字(正则，编码字符集)

<5>工程项目的src目录下创建包(包名：SD03364),创建java文件(ZBList,ZBDetail,ZBParams,ZBCombine)

<6>对api目录里的SampleResponse，文件进行解析页面，切出所需要数据,List,Detail(主要要补齐附件链接，图片链接)

<7>项目文件配置(主要是配置testUrl,开启代理后,自动弹出的页面)

<8>项目运行配置
　　右键ordered-apis，新建
　　右边API配置里，
　　　　API--选择抓下来的api目录
　　　　Handler--包名.类名(SD03363.ZBList)

<9>启动代理(Reactor)


<10>在本地的谷歌浏览器(新开一个，不用自动2弹出的)输入testUrl(项目文件配置),进行测试
　　　　[记得导入谷歌插件jsonview-chromein.com_ext_11247]

```

---
<br><br>